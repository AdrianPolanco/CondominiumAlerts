<shared-condominiums-layout>
  <div class="flex-1 bg-gray-900 p-5">
    <div class="flex justify-between mb-6">
      <shared-back-arrow url="/condominiums" />

      <div class="flex gap-1">
        <button
          class="bg-primary-contrast text-primary-700 px-4 py-2 rounded-md flex items-center hover:bg-primary-emphasis-alt hover:text-primary-contrast"
          (click)="goToCreatePosts()">
          <!-- Add button content here or remove if empty -->
        </button>

        <div class="flex space-x-2">
          <button class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-md flex items-center"
                  (click)="openPostModal()">
            <i class="pi pi-plus mr-2"></i>
            Nuevo post
          </button>

          <p-button
            label="Mantenimiento Niveles"
            styleClass="bg-primary-contrast text-primary-700 px-4 py-2 rounded-md flex items-center hover:bg-primary-emphasis-alt hover:text-primary-contrast"
            (onClick)="goToLevels()"
          />
        </div>
      </div>
    </div>

    <h2 class="text-xl md:text-4xl font-semibold mb-4 text-white">
      <i class="pi pi-pen-to-square mr-2 text-lg md:text-3xl"></i>
      Publicaciones
    </h2>

    <!-- Publicaciones -->
    <div class="space-y-4">
      <div *ngFor="let publication of publications"
           class="bg-gray-800 p-6 rounded-lg shadow-lg">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-xl font-bold text-primary-500">
            {{ publication.title }}
          </h3>
          <div class="flex items-center">
            <span class="text-sm text-gray-400 mr-2">{{ publication.time }}</span>
            <button *ngIf="isCurrentUserPost(publication.userId)"
                    class="text-gray-300 hover:text-white ml-2"
                    (click)="editPost(publication.id)">
              <i class="pi pi-pencil mr-1"></i> Editar
            </button>
          </div>
        </div>
        <p class="text-gray-300 mb-4">{{ publication.description }}</p>

        <div *ngIf="publication.imageUrl" class="w-full mb-4 rounded-lg overflow-hidden max-h-[400px] flex justify-center bg-transparent">
          <img [src]="publication.imageUrl"
               alt="Publicación"
               class="w-full h-auto object-contain rounded-lg" />
        </div>

        <div class="mt-4 flex items-center space-x-4">
          <button class="text-primary-500 hover:text-primary-600">
            <i class="pi pi-thumbs-up hover:pi-thumbs-up-fill"></i> Me gusta
          </button>
          <button class="text-secondary-400 hover:text-secondary-300">
            <i class="pi pi-comment"></i> Comentar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal para crear/editar posts -->
  <div class="modal" *ngIf="showPostModal">
    <div class="modal-content bg-gray-800 text-white rounded-xl shadow-2xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
      <h2 class="text-2xl font-bold mb-6 border-b border-gray-700 pb-2">
        {{ editingPost ? 'Editar Publicación' : 'Nueva Publicación' }}
      </h2>

      <form (ngSubmit)="savePost()" class="space-y-5">
        <div class="form-group">
          <label class="block mb-1 text-sm font-semibold">Título</label>
          <input type="text" [(ngModel)]="postForm.title" name="title"
                 class="w-full p-3 rounded-md bg-gray-900 text-white border border-gray-700 focus:outline-none focus:ring-2 focus:ring-primary"
                 required>
        </div>

        <div class="form-group">
          <label class="block mb-1 text-sm font-semibold">Descripción</label>
          <textarea [(ngModel)]="postForm.description" name="description"
                    rows="4"
                    class="w-full p-3 rounded-md bg-gray-900 text-white border border-gray-700 focus:outline-none focus:ring-2 focus:ring-primary"
                    required></textarea>
        </div>

        <div class="form-group">
          <label class="block mb-1 text-sm font-semibold">Nivel de Prioridad</label>
          <select [(ngModel)]="postForm.levelOfPriorityId" name="levelOfPriorityId"
                  class="w-full p-3 rounded-md bg-gray-900 text-white border border-gray-700 focus:outline-none focus:ring-2 focus:ring-primary"
                  required>
            <option value="" disabled selected>Selecciona un nivel</option>
            <option *ngFor="let level of priorityLevels"
                    [value]="level.id">
              {{ level.title }} (Prioridad: {{ level.priority }})
            </option>
          </select>
        </div>

        <div class="form-group">
          <label class="block mb-1 text-sm font-semibold">Imagen</label>
          <div *ngIf="postForm.currentImageUrl" class="mb-2">
            <img [src]="postForm.currentImageUrl" alt="Vista previa" class="rounded-md max-h-64 object-contain">
          </div>

          <label class="flex items-center justify-center px-4 py-2 bg-white border border-gray-300 text-black rounded-md cursor-pointer hover:bg-gray-50 transition-colors">
            <span class="mr-1">+</span> Subir imagen
            <input type="file" (change)="onFileSelected($event)" accept="image/*" class="hidden">
          </label>

          <small *ngIf="editingPost && !postForm.imageFile" class="text-xs text-gray-500">
            Dejar en blanco para mantener la imagen actual
          </small>
        </div>

        <div class="flex justify-end space-x-3 pt-4 border-t border-gray-700 mt-6">
          <button type="button"
                  (click)="closePostModal()"
                  class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-md">
            Cancelar
          </button>
          <button type="submit"
                  [disabled]="!postForm.title || !postForm.description"
                  class="bg-red-600 hover:bg-red-700 text-white px-5 py-2 rounded-md font-semibold">
            {{ editingPost ? 'Actualizar' : 'Publicar' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <shared-chats-drawer (onCondominiumSelected)="onCondominiumSelected()"></shared-chats-drawer>
</shared-condominiums-layout>
